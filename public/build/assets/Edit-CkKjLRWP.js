import{T as M,r as k,J as Q,A as W,E as H,a as i,c as J,w as K,b as n,u as l,Z,d as e,t as o,g as c,h as g,k as u,y as $,v as y,F as z,p as A,O as X}from"./app-DA0EYa_6.js";import{I as Y}from"./IconArrowLeft-gRB0gwWT.js";import{I as ee}from"./IconSearch-hVNvfgeb.js";import{I as te}from"./IconTrash-BZm3hFVP.js";import{_ as se}from"./DashboardLayout-DqHF1oae.js";import{_ as v}from"./Button-mcRGNCmf.js";import{_ as F}from"./InputSelect-BqzyB0VS.js";import{l as re}from"./lodash-De9ynbB3.js";import"./createVueComponent-CUBUAVU4.js";import"./IconUsers-CzMPbSiM.js";import"./IconSun-9pmbsCzq.js";import"./IconFileInvoice-DqQY055S.js";import"./IconReceipt-DjQT6mN-.js";import"./IconShoppingCart-qle56F5S.js";import"./IconCircleFilled-C8aRf-1y.js";const ae={class:"mb-6"},le={class:"flex items-center justify-between"},oe={class:"text-sm text-slate-500 dark:text-slate-400"},de={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ie={class:"lg:col-span-1 space-y-6"},ne={class:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-6"},ce={class:"space-y-4"},pe={key:0,class:"p-4 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700"},ue={class:"font-medium text-slate-900 dark:text-white"},be={class:"text-sm text-slate-500 dark:text-slate-400 mt-1"},me={class:"text-sm text-slate-500 dark:text-slate-400"},he={class:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-6"},xe={class:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-6"},_e={class:"flex gap-4"},ke={class:"flex-1 cursor-pointer"},ge={class:"flex-1 cursor-pointer"},ye={class:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-6"},fe={class:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-6"},ve={class:"relative"},we={class:"flex items-center gap-2 mb-2"},Se={key:0,class:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-xl max-h-64 overflow-y-auto"},Ie=["onClick"],Ce={class:"flex items-center gap-3"},Pe={class:"w-10 h-10 rounded-lg bg-slate-100 dark:bg-slate-700 flex-shrink-0"},Ve=["src"],Te={class:"font-medium text-slate-900 dark:text-white text-sm"},qe={class:"text-xs text-slate-500"},Ue={class:"ml-auto text-right"},Be={class:"text-xs font-semibold text-slate-700 dark:text-slate-300"},Ee={class:"lg:col-span-2"},je={class:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-6 h-full flex flex-col"},De={class:"flex-1 overflow-x-auto"},$e={class:"w-full"},ze={class:"divide-y divide-slate-100 dark:divide-slate-700"},Ae={key:0},Fe={class:"py-3 pl-2"},Ne={class:"flex flex-col"},Ge={class:"font-medium text-slate-900 dark:text-white text-sm"},Oe={class:"text-xs text-slate-500"},Re={class:"py-3 text-right"},Le=["onUpdate:modelValue"],Me={class:"py-3 text-center"},Qe=["onUpdate:modelValue"],We={class:"py-3 text-right font-medium text-slate-900 dark:text-white text-sm"},He={class:"py-3 text-center"},Je=["onClick"],Ke={class:"mt-6 pt-6 border-t border-slate-100 dark:border-slate-700"},Ze={class:"flex justify-between items-center mb-6"},Xe={class:"text-2xl font-bold text-primary-600 dark:text-primary-400"},Ye={class:"flex justify-end gap-3"},ht={__name:"Edit",props:{suppliers:Array,warehouses:Array,purchase:Object},setup(h){var P,V,T,q,U,B,E,j,D;const d=h,a=M({supplier_id:((P=d.purchase)==null?void 0:P.supplier_id)||"",warehouse_id:((V=d.purchase)==null?void 0:V.warehouse_id)||"",grand_total:((T=d.purchase)==null?void 0:T.grand_total)||0,payment_type:((q=d.purchase)==null?void 0:q.payment_type)||"cash",notes:((U=d.purchase)==null?void 0:U.notes)||"",items:((E=(B=d.purchase)==null?void 0:B.details)==null?void 0:E.map(s=>{var t,r;return{product_id:s.product_id,title:(t=s.product)==null?void 0:t.title,barcode:(r=s.product)==null?void 0:r.barcode,buy_price:s.buy_price,qty:s.qty}}))||[]}),p=k(((j=d.purchase)==null?void 0:j.supplier)||null),w=k(((D=d.purchase)==null?void 0:D.warehouse)||null),b=k(""),m=k([]),N=s=>{p.value=s,a.supplier_id=s?s.id:""},G=s=>{w.value=s,a.warehouse_id=s?s.id:""},S=re.debounce(async()=>{if(!b.value){m.value=[];return}try{const s=await Q.post(x("purchases.searchProduct"),{q:b.value});m.value=s.data}catch(s){console.error(s)}},300),O=s=>{const t=a.items.find(r=>r.product_id===s.id);t?t.qty++:a.items.push({product_id:s.id,title:s.title,barcode:s.barcode,buy_price:s.buy_price,qty:1}),b.value="",m.value=[]},R=s=>{a.items.splice(s,1)},I=W(()=>a.items.reduce((s,t)=>s+t.buy_price*t.qty,0));H(I,s=>{a.grand_total=s});const L=()=>{a.put(x("purchases.update",d.purchase.id))},C=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s||0),x=(s,t)=>typeof window<"u"&&window.route?window.route(s,t):"#";return(s,t)=>(i(),J(se,null,{default:K(()=>[n(l(Z),{title:"Edit Pembelian"}),e("div",ae,[e("div",le,[e("div",null,[t[6]||(t[6]=e("h1",{class:"text-2xl font-bold text-slate-900 dark:text-white"},"Edit Pembelian",-1)),e("p",oe," Edit transaksi pembelian "+o(h.purchase.invoice)+". ",1)]),n(v,{type:"link",icon:l(Y),class:"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800",label:"Kembali",href:x("purchases.index")},null,8,["icon","href"])])]),e("div",de,[e("div",ie,[e("div",ne,[t[7]||(t[7]=e("h3",{class:"font-semibold text-slate-900 dark:text-white mb-4"},"Informasi Supplier",-1)),e("div",ce,[n(F,{label:"Pilih Supplier",data:h.suppliers,selected:p.value,"set-selected":N,placeholder:"Pilih Supplier...",searchable:!0,errors:l(a).errors.supplier_id},null,8,["data","selected","errors"]),p.value?(i(),c("div",pe,[e("p",ue,o(p.value.name),1),e("p",be,o(p.value.address||"-"),1),e("p",me,o(p.value.phone||"-"),1)])):g("",!0)])]),e("div",he,[t[8]||(t[8]=e("h3",{class:"font-semibold text-slate-900 dark:text-white mb-4"},"Gudang Tujuan",-1)),n(F,{label:"Pilih Gudang",data:h.warehouses,selected:w.value,"set-selected":G,placeholder:"Pilih Gudang...",searchable:!0,errors:l(a).errors.warehouse_id},null,8,["data","selected","errors"])]),e("div",xe,[t[11]||(t[11]=e("h3",{class:"font-semibold text-slate-900 dark:text-white mb-4"},"Tipe Pembayaran",-1)),e("div",_e,[e("label",ke,[u(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=r=>l(a).payment_type=r),value:"cash",class:"hidden peer"},null,512),[[$,l(a).payment_type]]),t[9]||(t[9]=e("div",{class:"p-3 text-center rounded-xl border border-slate-200 dark:border-slate-700 peer-checked:border-primary-500 peer-checked:bg-primary-50 dark:peer-checked:bg-primary-500/10 peer-checked:text-primary-600 transition-all font-medium text-sm"}," Tunai ",-1))]),e("label",ge,[u(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=r=>l(a).payment_type=r),value:"tempo",class:"hidden peer"},null,512),[[$,l(a).payment_type]]),t[10]||(t[10]=e("div",{class:"p-3 text-center rounded-xl border border-slate-200 dark:border-slate-700 peer-checked:border-amber-500 peer-checked:bg-amber-50 dark:peer-checked:bg-amber-500/10 peer-checked:text-amber-600 transition-all font-medium text-sm"}," Tempo ",-1))])])]),e("div",ye,[t[12]||(t[12]=e("h3",{class:"font-semibold text-slate-900 dark:text-white mb-4"},"Catatan",-1)),u(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=r=>l(a).notes=r),placeholder:"Catatan/keterangan (opsional)",class:"w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-slate-200 placeholder-slate-400 focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all outline-none resize-none",rows:"3"},null,512),[[y,l(a).notes]])]),e("div",fe,[t[13]||(t[13]=e("h3",{class:"font-semibold text-slate-900 dark:text-white mb-4"},"Cari Produk",-1)),e("div",ve,[e("div",we,[n(l(ee),{size:20,class:"text-slate-400"}),u(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=r=>b.value=r),onInput:t[4]||(t[4]=(...r)=>l(S)&&l(S)(...r)),placeholder:"Scan barcode atau ketik nama...",class:"w-full h-11 px-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-slate-200 placeholder-slate-400 focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all outline-none"},null,544),[[y,b.value]])]),m.value.length>0?(i(),c("div",Se,[(i(!0),c(z,null,A(m.value,r=>(i(),c("div",{key:r.id,onClick:f=>O(r),class:"p-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer border-b border-slate-100 dark:border-slate-700 last:border-0"},[e("div",Ce,[e("div",Pe,[r.image?(i(),c("img",{key:0,src:r.image,class:"w-full h-full object-cover rounded-lg"},null,8,Ve)):g("",!0)]),e("div",null,[e("p",Te,o(r.title),1),e("p",qe,o(r.barcode),1)]),e("div",Ue,[e("p",Be,"Stok: "+o(r.stock),1)])])],8,Ie))),128))])):g("",!0)])])]),e("div",Ee,[e("div",je,[t[17]||(t[17]=e("h3",{class:"font-semibold text-slate-900 dark:text-white mb-4"},"Daftar Item",-1)),e("div",De,[e("table",$e,[t[15]||(t[15]=e("thead",null,[e("tr",{class:"border-b border-slate-100 dark:border-slate-700 text-left text-sm text-slate-500"},[e("th",{class:"pb-3 pl-2"},"Produk"),e("th",{class:"pb-3 text-right"},"Harga Beli"),e("th",{class:"pb-3 text-center w-24"},"Qty"),e("th",{class:"pb-3 text-right"},"Subtotal"),e("th",{class:"pb-3 w-10"})])],-1)),e("tbody",ze,[l(a).items.length===0?(i(),c("tr",Ae,[...t[14]||(t[14]=[e("td",{colspan:"5",class:"py-8 text-center text-slate-500 italic text-sm"}," Belum ada item dipilih ",-1)])])):g("",!0),(i(!0),c(z,null,A(l(a).items,(r,f)=>(i(),c("tr",{key:f,class:"group"},[e("td",Fe,[e("div",Ne,[e("span",Ge,o(r.title),1),e("span",Oe,o(r.barcode),1)])]),e("td",Re,[u(e("input",{type:"number","onUpdate:modelValue":_=>r.buy_price=_,min:"0",class:"w-32 px-2 py-1 text-right text-sm rounded-lg border border-slate-200 bg-slate-50 focus:border-primary-500 focus:ring-0 dark:bg-slate-800 dark:border-slate-700 dark:text-white"},null,8,Le),[[y,r.buy_price]])]),e("td",Me,[u(e("input",{type:"number","onUpdate:modelValue":_=>r.qty=_,min:"0",class:"w-20 px-2 py-1 text-center text-sm rounded-lg border border-slate-200 bg-slate-50 focus:border-primary-500 focus:ring-0 dark:bg-slate-800 dark:border-slate-700 dark:text-white"},null,8,Qe),[[y,r.qty]])]),e("td",We,o(C(r.buy_price*r.qty)),1),e("td",He,[e("button",{onClick:_=>R(f),class:"text-slate-400 hover:text-danger-500 transition-colors"},[n(l(te),{size:18})],8,Je)])]))),128))])])]),e("div",Ke,[e("div",Ze,[t[16]||(t[16]=e("span",{class:"text-lg font-bold text-slate-700 dark:text-slate-300"},"Total Pembelian",-1)),e("span",Xe,o(C(I.value)),1)]),e("div",Ye,[n(v,{type:"button",label:"Batal",class:"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800",onClick:t[5]||(t[5]=r=>l(X).visit(x("purchases.index")))}),n(v,{type:"submit",label:"Simpan Transaksi",class:"bg-primary-500 hover:bg-primary-600 text-white shadow-lg shadow-primary-500/30",processing:l(a).processing,disabled:l(a).items.length===0||!l(a).supplier_id||!l(a).warehouse_id,onClick:L},null,8,["processing","disabled"])])])])])])]),_:1}))}};export{ht as default};
