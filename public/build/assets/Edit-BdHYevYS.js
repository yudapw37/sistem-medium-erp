import{T as F,r as T,A as k,a as i,c as H,w as g,b as l,u as r,Z as L,d as t,e as h,j as M,t as d,k as c,x as P,g as n,p as w,F as I,v as y,h as U,f as O,J as Q}from"./app-CIYeQ-4j.js";import{I as G}from"./IconArrowLeft-D_cLVqwd.js";import{I as K}from"./IconDeviceFloppy-DbcGo2jm.js";import{I as J}from"./IconSearch-_c1o4uNe.js";import{I as Z}from"./IconTrash-CUcDdroG.js";import{_ as W}from"./DashboardLayout-CDE7-Y8V.js";import{_ as N}from"./TableCard-DWxSJUUQ.js";import{_ as C}from"./Button-CxuUSqWK.js";import{_ as p}from"./InputError-CneSCvv_.js";import"./createVueComponent-Cyzcg1Tn.js";import"./IconUsers-lhp4zDA0.js";import"./IconSun-B2kMHmLk.js";import"./IconFileInvoice-CDLMKT3Q.js";import"./IconReceipt-CzHzcLcH.js";import"./IconShoppingCart-C-7we8qa.js";const X={class:"mb-6"},Y={class:"text-sm text-slate-500"},tt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},et={class:"lg:col-span-2 space-y-6"},st={class:"p-6"},at={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},rt=["value"],ot={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},lt=["value"],dt={class:"p-6"},it={class:"mb-4 relative"},nt={class:"relative"},ut=["disabled","placeholder"],ct={key:0,class:"absolute z-50 left-0 right-0 mt-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden max-h-64 overflow-y-auto"},pt=["onClick"],bt={class:"flex justify-between items-center"},mt={class:"font-medium text-slate-900 dark:text-white"},xt={class:"text-xs text-slate-500"},ft={class:"text-right"},gt={class:"text-xs font-semibold text-slate-500"},ht={class:"text-sm font-bold text-primary-600"},yt={class:"overflow-x-auto"},_t={class:"w-full text-sm"},vt={class:"divide-y divide-slate-100 dark:divide-slate-700"},kt={class:"px-3 py-4"},wt={class:"font-medium text-slate-900 dark:text-white"},It={class:"text-xs text-slate-500"},Vt={class:"px-3 py-4"},Tt=["onUpdate:modelValue"],Pt={class:"px-3 py-4 text-right"},Nt=["onUpdate:modelValue"],Rt={class:"px-3 py-4 text-right"},Ut={class:"px-3 py-4 text-center"},Ct=["onClick"],St={key:0},qt={class:"space-y-6"},zt={class:"p-6"},Dt={class:"space-y-3"},jt={class:"flex justify-between text-sm text-slate-500"},At={class:"font-medium text-slate-900 dark:text-white"},Bt={class:"flex justify-between text-sm text-slate-500"},Et={class:"font-medium text-slate-900 dark:text-white"},$t={class:"pt-3 border-t border-slate-100 dark:border-slate-700"},Ft={class:"flex justify-between text-base font-bold"},Ht={class:"text-primary-600"},Lt={class:"mt-6 space-y-3"},oe={__name:"Edit",props:{transaction:Object,warehouses:Array,reasonLabels:Object,outReasons:Array,inReasons:Array},setup(_){const u=_,a=F({type:u.transaction.type,reason:u.transaction.reason,warehouse_id:u.transaction.warehouse_id,date:u.transaction.date.substr(0,10),notes:u.transaction.notes||"",items:u.transaction.details.map(o=>({product_id:o.product_id,title:o.product.title,barcode:o.product.barcode,qty:o.qty,buy_price:o.buy_price}))}),b=T(""),m=T([]),R=T(!1),S=k(()=>a.type==="in"?u.inReasons:u.outReasons),q=()=>{a.reason=""},z=async()=>{if(b.value.length<2){m.value=[];return}R.value=!0;try{const o=await Q.post(v("zero-value-transactions.searchProduct"),{search:b.value,warehouse_id:a.warehouse_id});m.value=o.data}catch(o){console.error("Error searching products:",o)}finally{R.value=!1}},D=o=>{const e=a.items.find(s=>s.product_id===o.id);e?e.qty++:a.items.push({product_id:o.id,title:o.title,barcode:o.barcode,qty:1,buy_price:o.buy_price}),b.value="",m.value=[]},j=o=>{a.items.splice(o,1)},A=k(()=>a.items.length),B=k(()=>a.items.reduce((o,e)=>o+e.qty,0)),E=k(()=>a.items.reduce((o,e)=>o+e.qty*e.buy_price,0)),V=o=>new Intl.NumberFormat("id-ID").format(o),v=(o,e)=>typeof window<"u"&&window.route?window.route(o,e):"#",$=()=>{a.put(v("zero-value-transactions.update",u.transaction.id))};return(o,e)=>(i(),H(W,null,{default:g(()=>[l(r(L),{title:"Edit Transaksi Nilai Nol"}),t("div",X,[l(r(M),{href:v("zero-value-transactions.index"),class:"inline-flex items-center text-sm text-slate-500 hover:text-primary-600 transition-colors mb-2"},{default:g(()=>[l(r(G),{size:16,class:"mr-1"}),e[6]||(e[6]=h(" Kembali ke Daftar ",-1))]),_:1},8,["href"]),e[7]||(e[7]=t("h1",{class:"text-2xl font-bold text-slate-900 dark:text-white"},"Edit Transaksi Nilai Nol",-1)),t("p",Y,d(_.transaction.code),1)]),t("form",{onSubmit:O($,["prevent"])},[t("div",tt,[t("div",et,[l(N,{title:"Detail Transaksi"},{default:g(()=>[t("div",st,[t("div",at,[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},[h(" Tipe Transaksi "),t("span",{class:"text-red-500"},"*")],-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>r(a).type=s),class:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",onChange:q},[...e[8]||(e[8]=[t("option",{value:"out"},"Stok Keluar (Rusak/Expired/Hibah)",-1),t("option",{value:"in"},"Stok Masuk (Bonus/Hadiah)",-1)])],544),[[P,r(a).type]]),l(p,{message:r(a).errors.type},null,8,["message"])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},[h(" Alasan "),t("span",{class:"text-red-500"},"*")],-1)),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>r(a).reason=s),class:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"},[e[10]||(e[10]=t("option",{value:""},"Pilih Alasan",-1)),(i(!0),n(I,null,w(S.value,s=>(i(),n("option",{key:s,value:s},d(_.reasonLabels[s]),9,rt))),128))],512),[[P,r(a).reason]]),l(p,{message:r(a).errors.reason},null,8,["message"])])]),t("div",ot,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},[h(" Gudang "),t("span",{class:"text-red-500"},"*")],-1)),c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>r(a).warehouse_id=s),class:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"},[e[12]||(e[12]=t("option",{value:""},"Pilih Gudang",-1)),(i(!0),n(I,null,w(_.warehouses,s=>(i(),n("option",{key:s.id,value:s.id},d(s.name),9,lt))),128))],512),[[P,r(a).warehouse_id]]),l(p,{message:r(a).errors.warehouse_id},null,8,["message"])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},[h(" Tanggal "),t("span",{class:"text-red-500"},"*")],-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r(a).date=s),type:"date",class:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"},null,512),[[y,r(a).date]]),l(p,{message:r(a).errors.date},null,8,["message"])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"}," Catatan ",-1)),c(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>r(a).notes=s),rows:"3",class:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Opsional..."},null,512),[[y,r(a).notes]]),l(p,{message:r(a).errors.notes},null,8,["message"])])])]),_:1}),l(N,{title:"Daftar Produk"},{default:g(()=>[t("div",dt,[t("div",it,[t("div",nt,[l(r(J),{size:18,class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),type:"text",disabled:!r(a).warehouse_id,placeholder:r(a).warehouse_id?"Cari produk berdasarkan nama atau kode...":"Pilih gudang terlebih dahulu...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",onInput:z},null,40,ut),[[y,b.value]])]),m.value.length>0?(i(),n("div",ct,[(i(!0),n(I,null,w(m.value,s=>{var x;return i(),n("button",{key:s.id,type:"button",class:"w-full text-left px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors border-b border-slate-100 dark:border-slate-700 last:border-0",onClick:f=>D(s)},[t("div",bt,[t("div",null,[t("p",mt,d(s.title),1),t("p",xt,d(s.barcode)+" | "+d((x=s.category)==null?void 0:x.name),1)]),t("div",ft,[t("p",gt,"Stok: "+d(s.warehouse_stock),1),t("p",ht,"Rp "+d(V(s.buy_price)),1)])])],8,pt)}),128))])):U("",!0)]),t("div",yt,[t("table",_t,[e[17]||(e[17]=t("thead",{class:"bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-400 font-semibold border-b border-slate-100 dark:border-slate-700"},[t("tr",null,[t("th",{class:"px-3 py-3 text-left"},"Produk"),t("th",{class:"px-3 py-3 text-center w-32"},"Qty"),t("th",{class:"px-3 py-3 text-right"},"HPP (Satuan)"),t("th",{class:"px-3 py-3 text-right"},"Subtotal"),t("th",{class:"px-3 py-3 text-center w-16"})])],-1)),t("tbody",vt,[(i(!0),n(I,null,w(r(a).items,(s,x)=>(i(),n("tr",{key:x},[t("td",kt,[t("div",wt,d(s.title),1),t("div",It,d(s.barcode),1)]),t("td",Vt,[c(t("input",{"onUpdate:modelValue":f=>s.qty=f,type:"number",min:"1",class:"w-full px-2 py-1 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-center"},null,8,Tt),[[y,s.qty,void 0,{number:!0}]])]),t("td",Pt,[c(t("input",{"onUpdate:modelValue":f=>s.buy_price=f,type:"number",min:"0",class:"w-full px-2 py-1 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-right"},null,8,Nt),[[y,s.buy_price,void 0,{number:!0}]])]),t("td",Rt," Rp "+d(V(s.qty*s.buy_price)),1),t("td",Ut,[t("button",{type:"button",class:"text-red-500 hover:text-red-700",onClick:f=>j(x)},[l(r(Z),{size:18})],8,Ct)])]))),128)),r(a).items.length===0?(i(),n("tr",St,[...e[16]||(e[16]=[t("td",{colspan:"5",class:"px-3 py-8 text-center text-slate-400 italic"}," Belum ada produk yang ditambahkan ",-1)])])):U("",!0)])])]),l(p,{message:r(a).errors.items},null,8,["message"])])]),_:1})]),t("div",qt,[l(N,{title:"Ringkasan"},{default:g(()=>[t("div",zt,[t("div",Dt,[t("div",jt,[e[18]||(e[18]=t("span",null,"Total Item",-1)),t("span",At,d(A.value),1)]),t("div",Bt,[e[19]||(e[19]=t("span",null,"Total Qty",-1)),t("span",Et,d(B.value),1)]),t("div",$t,[t("div",Ft,[e[20]||(e[20]=t("span",{class:"text-slate-900 dark:text-white"},"Total Nilai (HPP)",-1)),t("span",Ht,"Rp "+d(V(E.value)),1)])])]),t("div",Lt,[l(C,{type:"submit",class:"w-full bg-primary-500 hover:bg-primary-600 text-white shadow-lg shadow-primary-500/30 py-3",label:"Update Draft",disabled:r(a).processing,icon:r(K)},null,8,["disabled","icon"]),l(C,{type:"link",href:v("zero-value-transactions.index"),class:"w-full bg-slate-100 hover:bg-slate-200 text-slate-700 py-3 text-center block rounded-xl font-semibold",label:"Batal"},null,8,["href"])])])]),_:1})])])],32)]),_:1}))}};export{oe as default};
